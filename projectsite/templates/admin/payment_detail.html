{% extends "base.html" %}

{% block title %}{{ payment.or_number }} - Payment{% endblock %}

{% block content %}
<div class="up-card overflow-hidden">
    <!-- Compact Header with Gradient -->
    <div class="{% if payment.is_void %}bg-gradient-to-r from-red-600 to-red-500{% else %}bg-gradient-to-r from-emerald-600 via-teal-500 to-orange-500{% endif %} px-4 py-3">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div class="d-flex align-items-center gap-2">
                <a href="{% url 'payment_list' %}" class="text-white text-decoration-none opacity-75 hover:opacity-100">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </a>
                <div>
                    <h5 class="text-white mb-0 fw-semibold">{{ payment.or_number }}</h5>
                    <small class="text-white opacity-75">{{ payment.created_at|date:"M d, Y h:i A" }}</small>
                </div>
            </div>
            <div class="d-flex align-items-center gap-2">
                {% if payment.is_void %}
                    <span class="badge bg-white text-danger fw-semibold px-3 py-2">VOIDED</span>
                {% else %}
                    <span class="badge bg-white text-emerald-700 fw-semibold px-3 py-2">{{ payment.status }}</span>
                    <a href="{% url 'officer_void_payment' payment.pk %}" class="btn btn-sm btn-light text-danger">
                        <i data-lucide="ban" class="w-4 h-4 me-1"></i>Void
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="card-body p-4">
        <!-- Amount Highlight -->
        <div class="mb-4 pb-3 border-bottom">
            <div class="d-flex align-items-baseline gap-2">
                <span class="fs-2 fw-bold text-emerald-600">₱{{ payment.amount|floatformat:2 }}</span>
                {% if payment.amount_received != payment.amount %}
                <span class="text-muted small">
                    (Received: ₱{{ payment.amount_received|floatformat:2 }} • Change: ₱{{ payment.change_given|floatformat:2 }})
                </span>
                {% endif %}
            </div>
        </div>
        
        <!-- Compact Single Column List -->
        <div class="d-flex flex-column gap-3">
            <div class="d-flex align-items-start gap-2">
                <div class="rounded-circle bg-emerald-100 p-2 flex-shrink-0">
                    <i data-lucide="user" class="w-4 h-4 text-emerald-600"></i>
                </div>
                <div class="min-w-0">
                    <div class="text-muted small">Student</div>
                    <div class="fw-medium">{{ payment.student.get_full_name }} <span class="text-muted fw-normal">{{ payment.student.student_id_number }}</span></div>
                </div>
            </div>
            
            <div class="d-flex align-items-start gap-2">
                <div class="rounded-circle bg-teal-100 p-2 flex-shrink-0">
                    <i data-lucide="building-2" class="w-4 h-4 text-teal-600"></i>
                </div>
                <div class="min-w-0">
                    <div class="text-muted small">Organization</div>
                    <div class="fw-medium">{{ payment.organization.name }} <span class="text-muted fw-normal">({{ payment.organization.code }})</span></div>
                </div>
            </div>
            
            <div class="d-flex align-items-start gap-2">
                <div class="rounded-circle bg-orange-100 p-2 flex-shrink-0">
                    <i data-lucide="tag" class="w-4 h-4 text-orange-600"></i>
                </div>
                <div class="min-w-0">
                    <div class="text-muted small">Fee Type</div>
                    <div class="fw-medium">{{ payment.fee_type.name }}</div>
                </div>
            </div>
            
            <div class="d-flex align-items-start gap-2">
                <div class="rounded-circle bg-blue-100 p-2 flex-shrink-0">
                    <i data-lucide="credit-card" class="w-4 h-4 text-blue-600"></i>
                </div>
                <div class="min-w-0">
                    <div class="text-muted small">Payment Method</div>
                    <div class="fw-medium">{{ payment.get_payment_method_display }}</div>
                </div>
            </div>
            
            <div class="d-flex align-items-start gap-2">
                <div class="rounded-circle bg-purple-100 p-2 flex-shrink-0">
                    <i data-lucide="user-check" class="w-4 h-4 text-purple-600"></i>
                </div>
                <div class="min-w-0">
                    <div class="text-muted small">Processed By</div>
                    <div class="fw-medium">{{ payment.processed_by.get_full_name|default:"N/A" }}</div>
                </div>
            </div>
            
            {% if payment.receipt %}
            <div class="d-flex align-items-start gap-2">
                <div class="rounded-circle bg-green-100 p-2 flex-shrink-0">
                    <i data-lucide="receipt" class="w-4 h-4 text-green-600"></i>
                </div>
                <div class="min-w-0">
                    <div class="text-muted small">Receipt</div>
                    <div class="d-flex align-items-center gap-2">
                        <a href="{% url 'receipt_detail' payment.receipt.pk %}" class="fw-medium text-emerald-600 text-decoration-none hover:underline">View Receipt</a>
                        {% if payment.receipt.email_sent %}
                            <span class="badge bg-success-subtle text-success">Emailed</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        {% if payment.notes %}
        <div class="mt-3 pt-3 border-top">
            <div class="text-muted small mb-1">Notes</div>
            <div class="text-muted">{{ payment.notes }}</div>
        </div>
        {% endif %}
        
        {% if payment.is_void %}
        <!-- Void Information -->
        <div class="mt-3 pt-3 border-top">
            <div class="alert alert-danger mb-0 py-2">
                <div class="d-flex align-items-start gap-2">
                    <i data-lucide="alert-circle" class="w-4 h-4 flex-shrink-0 mt-1"></i>
                    <div>
                        <div class="fw-semibold small">Voided by {{ payment.voided_by.get_full_name|default:"N/A" }}</div>
                        <div class="small">{{ payment.voided_at|date:"M d, Y h:i A" }}</div>
                        {% if payment.void_reason %}
                        <div class="small mt-1">Reason: {{ payment.void_reason }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
});
</script>
{% endblock %}












